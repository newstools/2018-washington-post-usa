Negotiators closed in on a $1.3 trillion spending deal early Wednesday that includes — according to three officials familiar with its outlines — some obstacles to President Trump’s immigration agenda but leaves unfunded a major New York area infrastructure project he fiercely opposes. With talks in their final stages, congressional leaders hoped to release a bill Wednesday morning with hopes of passing the legislation before a Friday night government shutdown deadline. But leaders left open the possibility that a short-term patch might be needed, which could force lawmakers to work through the weekend. According to the three officials, who spoke on the condition of anonymity to describe sensitive negotiations, the spending deal includes $1.6 billion in funding for border-wall construction — delivering taxpayer funds to a key Trump priority. But the number is far short of the $25 billion the administration sought. Democrats also won tight restrictions on how the money can be spent, one official said. The Trump administration, meanwhile, succeeded in eliminating $900 million in planned seed funding for the $30 billion Gateway project to improve passenger rail access to and from Manhattan, including a new tunnel under the Hudson River. The project has been a key priority for lawmakers of both parties, including Senate Minority Leader Charles E. Schumer (D-N.Y.) and House Appropriations Committee Chairman Rodney Frelinghuysen (R-N.J.). But Trump, according to several officials familiar with his thinking, was determined not to hand Schumer a win while Democrats stood in the way of his administration’s priorities, and he issued a veto threat that the White House never backed off from. It is unclear how soon Congress might vote on the bill. House Republicans left a morning conference meeting Tuesday expecting to vote on the bill no sooner than Thursday. But that was before the bill’s release was delayed into Wednesday. In any case, the Senate will have scant time to act by Friday at midnight to stave off a third government shutdown this year. Because of the tight time frame, any one senator could take advantage of the chamber’s rules to extend debate beyond the deadline. “It could happen,” Sen. John Thune (S.D.), the No. 3 Senate Republican leader, said about the possibility of a short shutdown or a multiday bill that could keep lawmakers in Washington over the weekend as tens of thousands of protesters crowd the city to call for congressional action on gun control. The thorniest issue in the final talks seemed to surround immigration policy, according to aides familiar with the talks — including how much funding would be available to construct the border wall, as well as to hire immigration enforcement officers and support facilities to detain immigrants in the country illegally. In the final wall compromise, $1.6 billion will be available for physical barriers along the Mexican border, but there are strings attached. Most of the funding, officials said, can be used only for repairs or for “secondary” barriers along border stretches where there is already a wall. The rest can be used for 33 miles of new barriers, but there are restrictions on the type: Only levees or existing “bollard fence” can be built rather than the concrete prototypes Trump appears to favor. The bill also rejects a Trump administration request for more immigration enforcement officers and an increase in funding for detention facilities for illegal immigrants. Language in the bill, two officials said, holds the level of enforcement agents flat and does not allow the administration to add new detention beds. An effort to trade a much larger amount of border wall money for protections for certain young immigrants fell apart Tuesday. Trump continued to push for a last-minute deal as recently as Monday, but Democrats resisted the terms of the White House offer.  The omnibus legislation, which is expected to run upward of 1,000 pages, was supposed to be filed Monday, but that did not happen. Instead House GOP leaders told lawmakers Tuesday morning that they hoped to complete the bill later in the day and vote on it Thursday. “Hopefully soon,” House Speaker Paul D. Ryan (R-Wis.) told reporters Tuesday morning. “There are some unresolved issues. We’re working through them while we speak, and we’re hoping to close it today.” But by Tuesday evening, top congressional leaders weren’t guaranteeing that the bill would be done by day’s end. With conservatives expected to oppose the legislation on fiscal grounds, Democratic votes will be needed in both chambers to pass the legislation. That has empowered Democrats to make demands on a variety of issues while resisting GOP priorities. And because the legislation will be among the last major must-pass bills to move through Congress this year, it has become the vehicle for a number of unrelated priorities sought by the White House and lawmakers of both parties. Must-pass bills such as the omnibus, Senate Majority Whip John Cornyn (R-Tex.) said, “are traditionally where people go to get stuff done that they’ve been waiting to get done which won’t move on their own.” If the House acts Thursday, the Senate would have to get unanimous consent of its members to accelerate consideration of the bill to guarantee passage before the midnight deadline, meaning that any senator could delay proceedings and force a shutdown. In early February, Sen. Rand Paul (R-Ky.) held up consideration of a budget bill as he railed about the deficit, forcing a funding lapse of several hours on a Friday morning. Paul on Tuesday did not rule out doing the same thing this week, telling reporters he would review the bill before deciding whether to cooperate with party leaders. House Republicans left their closed-door conference meeting Tuesday frustrated at finding themselves again up against a spending deadline, though most expressed confidence that they would ultimately avoid a shutdown. “I don’t like how we always seem to wait till the last minute up here to come to terms with spending plans,” said Rep. James Comer (R-Ky.). The delays have mounted as Democrats have waged battle in closed-door negotiations with Republicans, taking on not only the GOP congressional leadership’s priorities but also those dear to Trump.         The White House and Republicans also pushed for inclusion of a measure known as the Fix NICS bill that would compel federal agencies to more correctly and accurately report information to the national criminal background check system. Democrats were seeking to couple that provision with a gun measure of their own, but it was uncertain if negotiators would reach agreement on the issue. One official said Wednesday morning that it was one of the few issues left unresolved. Also included in the bill are hundreds of millions of dollars to combat potential interference in the coming midterm elections from Russia and other potential interlopers, two of the officials said. The federal Election Assistance Commission will receive $380 million to dole out to states to improve their election cybersecurity. And the FBI, one official said, is set to receive $300 million in counterintelligence funding to combat Russian hacking.      Ed O’Keefe, Josh Dawsey and Seung Min Kim contributed to this report.  Read more at PowerPost